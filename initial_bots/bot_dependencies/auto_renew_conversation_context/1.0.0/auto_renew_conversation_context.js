(function(){var getConversationContext=function getConversationContext(message,botContext,previousMessages,user){var lastMessage=previousMessages?previousMessages[previousMessages.length-1]:null;var DeviceConversationContext=botContext.getCapability('ConversationContext');if(!lastMessage){return DeviceConversationContext.createAndSaveNewConversationContext(botContext,user);}var utils=botContext.getCapability('Utils');var moment=utils.moment;lastMessage=lastMessage.message;var now=new Date();if(moment(now).subtract(ELAPSED_TIME_FOR_NEW_CONVERSATION.NUM,ELAPSED_TIME_FOR_NEW_CONVERSATION.SCALE).toDate()>moment(lastMessage.getMessageDate())){return DeviceConversationContext.createAndSaveNewConversationContext(botContext,user);}return DeviceConversationContext.getConversationContext(botContext,user);};var setInstanceId=function setInstanceId(instanceId,botContext){var DeviceConversationContext=botContext.getCapability('ConversationContext');return DeviceConversationContext.setInstanceId(instanceId,botContext);};var getPreviousConversationContexts=function getPreviousConversationContexts(botContext,user){var DeviceConversationContext=botContext.getCapability('ConversationContext');return DeviceConversationContext.setInstanceId(botContext,user);};var activateConversationContext=function activateConversationContext(context,botContext,user){var DeviceConversationContext=botContext.getCapability('ConversationContext');return DeviceConversationContext.setInstanceId(context,botContext,user);};var ELAPSED_TIME_FOR_NEW_CONVERSATION={NUM:24,SCALE:'hours'};return{getConversationContext:getConversationContext,setInstanceId:setInstanceId,getPreviousConversationContexts:getPreviousConversationContexts,activateConversationContext:activateConversationContext};})();
