(function(){var FormHandler={updateUserInfo:function updateUserInfo(msg,state,previousMessages,botContext){var _=botContext.getCapability('Utils').Lodash;var userDetails={};var newDomain=null;var addDomain=false;botContext.wait(true);var authContext=botContext.getCapability('authContext');authContext.getAuthUser(botContext).then(function(user){var userInfo=user.info||{};var dbDocument={};var domains=userInfo.domains||[];newDomain=msg.getMessage();if(_.indexOf(domains,newDomain)===-1){addDomain=true;domains.push(newDomain);}dbDocument.domains=domains;var params={collection:"People",documents:[{key:{userId:user.userId},document:dbDocument}]};var agentGuardService=botContext.getCapability('agentGuardService');return agentGuardService.writeData(msg,botContext,user,previousMessages,params);}).then(function(){return authContext.addDomains(newDomain,botContext);}).then(function(){tell('You should now be able to access the featured partner\'s bot',botContext);return MenuHelper.showMenu(MENU.MAIN,botContext);}).catch(function(error){console.error('Error occurred while updating user details: ',error);tell('Error occurred: Unable to update details',botContext);return MenuHelper.showMenu(MENU.MAIN,botContext);});}};var MenuHandler={showActivateBotMsg:function showActivateBotMsg(message,state,previousMessages,botContext){tell('If a company has invited you to use their Bots, please scan the QR Code or type the invitation code',botContext);return MenuHelper.showMenu(MENU.MAIN,botContext);}};var MENU={MAIN:[{title:'Activate Enterprise Bots',action:MenuHandler.showActivateBotMsg}]};var botState={};var MenuHelper={showMenu:function showMenu(menuToShow,botContext){botState.menuToShow=menuToShow;var _=botContext.getCapability('Utils').Lodash;var Message=botContext.getCapability('Message');var message=new Message();var options=_.map(menuToShow,function(option){return{title:option.title};});message.sliderMessage(options,{smartReply:true});tell(message,botContext);}};var MessageProcessor={processStringMsg:function processStringMsg(message,state,previousMessages,botContext){var _=botContext.getCapability('Utils').Lodash;var strMsg=message.getMessage().toLowerCase();var botStateMenu=botState.menuToShow;var index=_.findIndex(botStateMenu,function(option){return option.title.toLowerCase()===strMsg;});if(index===-1){MessageProcessor.processSpecialString(strMsg,message,state,previousMessages,botContext);}else{botState.menuToShow[index].action(message,state,previousMessages,botContext);}},processSpecialString:function processSpecialString(strMsg,message,state,previousMessages,botContext){var Message=botContext.getCapability('Message');var companyMsg=new Message();if(strMsg==='addvaluefaq'){companyMsg.stringMessage('addvalue');return FormHandler.updateUserInfo(companyMsg,state,previousMessages,botContext);}else if(strMsg==='inmarsatchatbot'){companyMsg.stringMessage('inmarsat');return FormHandler.updateUserInfo(companyMsg,state,previousMessages,botContext);}else{return MessageProcessor.processNlp(message,state,previousMessages,botContext);}},processNlp:function processNlp(msg,state,previousMessages,botContext){var authContext=botContext.getCapability('authContext');var _=botContext.getCapability('Utils').Lodash;var ONBOARDING_NLP_ID='FMBot';botContext.wait(true);authContext.getAuthUser(botContext).then(function(user){var agentGuardService=botContext.getCapability('agentGuardService');return agentGuardService.nlp(msg,botContext,user,previousMessages,ONBOARDING_NLP_ID);}).then(function(queryResp){var Message=botContext.getCapability('Message');var messages=queryResp.messages||[];var action=queryResp.action;var _GREETING='smalltalk.';var _INPUT='input.';if(_.isEmpty(messages)){var strMsg=queryResp.speech||'Unable to get results for the query';tell(strMsg,botContext);return MenuHelper.showMenu(MENU.MAIN,botContext);}else if(_.includes(action,_INPUT)||_.includes(action,_GREETING)){var respMsg=queryResp.speech;tell(respMsg,botContext);}else if(action==='1_configurationMenu'){return MenuHelper.showMenu(MENU.CONFIG,botContext);}else{var type0Msg=_.find(messages,function(element){return element.type===0;});var type0MsgSpeech=type0Msg.speech;if(type0MsgSpeech){tell(type0MsgSpeech,botContext);}var typ2Or4Msg=_.find(messages,function(element){return element.type===4;});if(_.isEmpty(typ2Or4Msg)){typ2Or4Msg=_.find(messages,function(element){return element.type===2;});}if(typ2Or4Msg){var _messages=_.get(typ2Or4Msg,"payload.messages")||_.get(typ2Or4Msg,"replies")||[];var sliderMsgList=[];_.each(_messages,function(element){sliderMsgList.push({title:element});});var message=new Message();message.sliderMessage(sliderMsgList,{smartReply:true});tell(message,botContext);}else{return MenuHelper.showMenu(MENU.MAIN,botContext);}}});}};var tell=function tell(msg,botContext){botContext.tell(msg);};var greeting=function greeting(state,previousMessages,botContext){return MenuHelper.showMenu(MENU.MAIN,botContext);};var next=function next(message,state,previousMessages,botContext){var MessageTypeConstants=botContext.getCapability('MessageTypeConstants');var msgType=message.getMessageType();switch(msgType){case MessageTypeConstants.MESSAGE_TYPE_STRING:MessageProcessor.processStringMsg(message,state,previousMessages,botContext);break;}};var farewell=function farewell(){};var asyncResult=function asyncResult(result,state,previousMessages,botContext){};return{done:farewell,init:greeting,next:next,asyncResult:asyncResult,version:"1.0.0"};})();
